<!DOCTYPE html>
<html lang="en">
  <head>
    <title>GEODUDE WORKSPACE</title>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
      name="viewport"
    />
    <link href="main.css" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <div
      id="title"
      style="
        font-size: 40px;
        color: #1b1b1b;
        margin-top: 20px;
        font-weight: 600;
      "
    >
      GEOTHRERMAL DORM SYSTEM
    </div>

    <div class="container default" id="popup">
      <div class="popMain">
        <img id="popImg" src="Img/Home.JPG" />
        <h1 id="popHeader">Geothermal System</h1>
        <p id="popText" style="font-size: 15px">
          Welcome to our animated model of a Geothermal System!
        </p>
      </div>
    </div>

    <div class="names">
      Scott Comeaux, Logan Freeman, Joeseph Gomez, Jordan Martin
    </div>

    <style>
      body {
        margin: 0;
      }
    </style>

    <script type="module">
      import * as THREE from "./three.js/build/three.module.js";

      import { OrbitControls } from "./three.js/examples/jsm/controls/OrbitControls.js";
      import { GLTFLoader } from "./three.js/examples/jsm/loaders/GLTFLoader.js";
      import { RGBELoader } from "./three.js/examples/jsm/loaders/RGBELoader.js";
      import { RoughnessMipmapper } from "./three.js/examples/jsm/utils/RoughnessMipmapper.js";
      import { GUI } from "./three.js/examples/jsm/libs/dat.gui.module.js";

      //TESTING SNOW
      //THREE.ImageUtils.loadTexture("http://i.imgur.com/cTALZ.png");
      //import { snowHtml } from "./javascript/snowHtml.js";              //TESTING SNOW
      //import { snowThreejs } from "./javascript/snowThreejs.js";        //TESTING SNOW
      //use function to create snow call: "init()" from snowHtml.js

      let popup = document.getElementById("popup");
      let container, controls, clock, mixer;
      let ambientLight, camera, scene, renderer;
      let params = {
        showHome: showHome,
        showBoiler: showBoiler,
        showFluid: showFluid,
        showPipes: showPipes,
        showWell: showWell,
        rotation: true,
        /*showSnow: showSnow,*/
      };

      init();
      createGUI();
      animate();

      //TESTING SNOW
      // function showSnow() {
      //   snowHtml.init();
      //   snowThreejs;
      // }

      function showBoiler() {
        camera.position.set(19.5, 2, -1);
        controls.target.set(19.5, 2, -4);
        controls.update();
        camera.updateProjectionMatrix();

        popup.style.display = "flex";
        document.getElementById("popImg").src = "./Img/BoilerImage.jpg";
        document.getElementById("popHeader").innerHTML = "Boiler";
        document.getElementById("popText").innerHTML =
          "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque velit augue, consequat vitae nulla in, auctor interdum turpis.";
      }

      function showFluid() {
        camera.position.set(26, 3, 5);
        controls.target.set(21.3, 1, 4.7);
        controls.update();
        camera.updateProjectionMatrix();

        popup.style.display = "flex";
        document.getElementById("popImg").src =
          "https://i0.wp.com/tmrblog.com/wp-content/uploads/2019/12/cooling-tower-500x500.jpg?fit=500%2C412&ssl=1";
        document.getElementById("popHeader").innerHTML = "Cooling Tower";
        document.getElementById("popText").innerHTML =
          "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque velit augue, consequat vitae nulla in, auctor interdum turpis.";
      }

      function showHome() {
        camera.position.set(34, 10, 12);
        controls.target.set(15, 0, 0);
        controls.update();
        camera.updateProjectionMatrix();

        popup.style.display = "none";
      }

      function showPipes() {
        camera.position.set(12, 15, 19);
        controls.target.set(12, 0, -2);
        controls.update();
        camera.updateProjectionMatrix();

        popup.style.display = "flex";
        document.getElementById("popImg").src =
          "https://media.sciencephoto.com/t1/36/00/90/t1360090-800px-wm.jpg";
        document.getElementById("popHeader").innerHTML = "Pipes";
        document.getElementById("popText").innerHTML =
          "Heat is collected throughout the water wells and dissipated into the ground. Water returns to the dorms with a lower temperature.";
      }

      function showWell() {
        camera.position.set(8, -5, 0);
        controls.target.set(0.5, -5, -2);
        controls.update();
        camera.updateProjectionMatrix();

        popup.style.display = "flex";
        document.getElementById("popImg").src = "./Img/Well.jpg";
        document.getElementById("popHeader").innerHTML = "Geothermal Well";
        document.getElementById("popText").innerHTML =
          "These are created by drilling a large hole down into the earth, usually at least 3 inches in diameter, until a specific depth is reached that can supply enough geothermal energy to heat and cool the facility it will be installed in. Our 220 wells are 300â€™ underneath the ground.";
      }

      function init() {
        container = document.createElement("div");
        document.body.appendChild(container);

        camera = new THREE.PerspectiveCamera(
          90,
          window.innerWidth / window.innerHeight,
          0.1,
          1000
        );
        camera.position.set(34, 10, 12);

        scene = new THREE.Scene();
        clock = new THREE.Clock();

        new RGBELoader()
          .setDataType(THREE.UnsignedByteType)
          .setPath("Img/")
          .load("Gradient.hdr", function (texture) {
            let envMap = pmremGenerator.fromEquirectangular(texture).texture;

            scene.background = envMap;
            scene.environment = envMap;

            texture.dispose();
            pmremGenerator.dispose();
            render();

            let roughnessMipmapper = new RoughnessMipmapper(renderer);

            let loader = new GLTFLoader().setPath("Models/");
            loader.load("main.glb", function (gltf) {
              let model = gltf;
              let animations = gltf.animations;

              mixer = new THREE.AnimationMixer(gltf.scene);
              animations.forEach(function (clip) {
                mixer.clipAction(clip).play();
              });

              model.scene.traverse(function (child) {
                if (child.isMesh) {
                }
              });
              scene.add(model.scene);
              roughnessMipmapper.dispose();
              render();
            });
          });

        ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);

        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 1;
        renderer.outputEncoding = THREE.sRGBEncoding;
        container.appendChild(renderer.domElement);

        controls = new OrbitControls(camera, renderer.domElement);
        controls.addEventListener("change", render); // use if there is no animation loop
        controls.minDistance = 2;
        controls.maxDistance = 60;
        controls.target.set(15, 0, 0);
        controls.autoRotate = true;
        controls.autoRotateSpeed = 1.5;
        controls.update();

        let pmremGenerator = new THREE.PMREMGenerator(renderer);
        pmremGenerator.compileEquirectangularShader();

        window.addEventListener("resize", onWindowResize, false);
      }

      function createGUI() {
        let gui = new GUI({ name: "Damp setting" });
        gui.add(params, "showHome").name("Home View");
        gui.add(params, "showBoiler").name("Boiler");
        gui.add(params, "showFluid").name("Fluid Cooler");
        gui.add(params, "showPipes").name("Pipes");
        gui.add(params, "showWell").name("Geothermal Well");
        gui
          .add(params, "rotation")
          .name("Rotation")
          .onChange(function (val) {
            controls.autoRotate = val === true;
          }); //TESTING SNOW
        /*gui.add(params, "showSnow").name("Snow");*/ window.addEventListener(
          "resize",
          onWindowResize,
          false
        );
      }

      function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
        render();
      }

      function animate() {
        requestAnimationFrame(animate);
        controls.update();
        render();
      }

      function render() {
        let delta = clock.getDelta();

        if (mixer !== undefined) {
          mixer.update(delta);
        }
        renderer.render(scene, camera);
      }
    </script>
  </body>
</html>
