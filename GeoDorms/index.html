<!DOCTYPE html>
<html lang="en">
  <head>
    <title>GEODUDE WORKSPACE</title>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
      name="viewport"
    />
    <link href="main.css" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <div
      id="title"
      style="
        font-size: 40px;
        color: #1b1b1b;
        margin-top: 20px;
        font-weight: 600;
      "
    >
      GEOTHRERMAL DORM SYSTEM
    </div>

    <div class="container default" id="popup">
      <div class="popMain">
        <img id="popImg" src="Img/Home.JPG" />
        <h1 id="popHeader">Geothermal System</h1>
        <p id="popText" style="font-size: 15px">
          Welcome to our animated model of a Geothermal System!
        </p>
      </div>
    </div>

    <div class="names">
      Scott Comeaux, Logan Freeman, Joeseph Gomez, Jordan Martin
    </div>

    <style>
      body {
        margin: 0;
      }
    </style>

    <script type="module">
      import * as THREE from "./three.js/build/three.module.js";

      import { OrbitControls } from "./three.js/examples/jsm/controls/OrbitControls.js";
      import { GLTFLoader } from "./three.js/examples/jsm/loaders/GLTFLoader.js";
      import { RGBELoader } from "./three.js/examples/jsm/loaders/RGBELoader.js";
      import { ColladaLoader } from "./three.js/examples/jsm/loaders/ColladaLoader.js";
      import { RoughnessMipmapper } from "./three.js/examples/jsm/utils/RoughnessMipmapper.js";
      import { GUI } from "./three.js/examples/jsm/libs/dat.gui.module.js";

      let popup = document.getElementById("popup");
      let avatar, st, st2, st3;
      let clock, mixer, mixer2, mixer3, mixer4;
      let container, controls;
      let ambientLight, camera, scene, renderer;
      let params = {
        showHome: showHome,
        showBoiler: showBoiler,
        showFluid: showFluid,
        showPipes: showPipes,
        showWell: showWell,
        stormTroopers: false,
      };

      init();
      createGUI();
      animate();

      function showBoiler() {
        camera.position.set(19.5, 2, -1);
        controls.target.set(19.5, 2, -2);
        controls.update();
        camera.updateProjectionMatrix();

        popup.style.display = "flex";
        document.getElementById("popImg").src = "./Img/BoilerImage.jpg";
        document.getElementById("popHeader").innerHTML = "Boiler";
        document.getElementById("popText").innerHTML =
          "This isn't your average boiler. No, it's way better than that.  Like at least 10 times as good as a regular boiler!";
      }

      function showFluid() {
        camera.position.set(26, 4, 5);
        controls.target.set(22, 1, 5);
        controls.update();
        camera.updateProjectionMatrix();

        popup.style.display = "flex";
        document.getElementById("popImg").src =
          "https://i0.wp.com/tmrblog.com/wp-content/uploads/2019/12/cooling-tower-500x500.jpg?fit=500%2C412&ssl=1";
        document.getElementById("popHeader").innerHTML = "Cooling Tower";
        document.getElementById("popText").innerHTML =
          "This cools stuff I'm pretty sure!";
      }

      function showHome() {
        camera.position.set(34, 10, 12);
        controls.target.set(15, 0, 0);
        controls.update();
        camera.updateProjectionMatrix();

        popup.style.display = "none";
      }

      function showPipes() {
        camera.position.set(10, 20, 0);
        controls.target.set(10, 1, 0);
        controls.update();
        camera.updateProjectionMatrix();

        popup.style.display = "flex";
        document.getElementById("popImg").src =
          "https://media.sciencephoto.com/t1/36/00/90/t1360090-800px-wm.jpg";
        document.getElementById("popHeader").innerHTML = "Pipes";
        document.getElementById("popText").innerHTML =
          "These are definitely pipes";
      }

      function showWell() {
        camera.position.set(8, -5, 0);
        controls.target.set(0, -5, 0);
        controls.update();
        camera.updateProjectionMatrix();

        popup.style.display = "flex";
        document.getElementById("popImg").src = "./Img/Well.jpg";
        document.getElementById("popHeader").innerHTML = "Geothermal Well";
        document.getElementById("popText").innerHTML =
          "This well goes pretty deep.  Like 300ft deep.";
      }

      function init() {
        container = document.createElement("div");
        document.body.appendChild(container);

        camera = new THREE.PerspectiveCamera(
          90,
          window.innerWidth / window.innerHeight,
          0.1,
          1000
        );
        camera.position.set(34, 10, 12);

        scene = new THREE.Scene();
        clock = new THREE.Clock();

        new RGBELoader()
          .setDataType(THREE.UnsignedByteType)
            .setPath( 'Img/' )
            .load( 'Gradient.hdr', function ( texture ) {
            let envMap = pmremGenerator.fromEquirectangular(texture).texture;

            scene.background = envMap;
            scene.environment = envMap;

            texture.dispose();
            pmremGenerator.dispose();
            render();

            let roughnessMipmapper = new RoughnessMipmapper(renderer);

            let loader = new GLTFLoader().setPath("Models/");
            loader.load("main.glb", function (gltf) {
              var model = gltf
              model.scene.traverse(function (child) {
                if (child.isMesh) {
                }
              });
              scene.add(model.scene);
              roughnessMipmapper.dispose();
              render();
            });
          });

        let loader = new ColladaLoader();
        loader.load(
          "./three.js/examples/models/collada/stormtrooper/stormtrooper.dae",
          function (collada) {
            let animations = collada.animations;
            avatar = collada.scene;

            avatar.position.set(22.5, 9, -4);
            avatar.rotateZ(3);
            avatar.scale.set(0.8, 0.8, 0.8);

            mixer = new THREE.AnimationMixer(avatar);
            mixer.clipAction(animations[0]).play();
          }
        );

        let loader2 = new ColladaLoader();
        loader2.load(
          "./three.js/examples/models/collada/stormtrooper/stormtrooper.dae",
          function (collada) {
            let animations = collada.animations;
            st = collada.scene;

            st.position.set(2, 0, 4);
            st.rotateZ(5);
            st.scale.set(0.8, 0.8, 0.8);

            mixer2 = new THREE.AnimationMixer(st);
            mixer2.clipAction(animations[0]).play();
          }
        );

        let loader3 = new ColladaLoader();
        loader3.load(
          "./three.js/examples/models/collada/stormtrooper/stormtrooper.dae",
          function (collada) {
            let animations = collada.animations;
            st2 = collada.scene;

            st2.position.set(9, 0, -5);
            st2.rotateZ(2);
            st2.scale.set(2, 2, 1);

            mixer3 = new THREE.AnimationMixer(st2);
            mixer3.clipAction(animations[0]).play();
          }
        );

        let loader4 = new ColladaLoader();
        loader4.load(
          "./three.js/examples/models/collada/stormtrooper/stormtrooper.dae",
          function (collada) {
            let animations = collada.animations;
            st3 = collada.scene;

            st3.position.set(22, 2.3, 6);
            st3.rotateZ(4);
            st3.scale.set(0.4, 0.4, 0.4);

            mixer4 = new THREE.AnimationMixer(st3);
            mixer4.clipAction(animations[0]).play();
          }
        );

        ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);

        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 1;
        renderer.outputEncoding = THREE.sRGBEncoding;
        container.appendChild(renderer.domElement);

        controls = new OrbitControls(camera, renderer.domElement);
        controls.addEventListener("change", render); // use if there is no animation loop
        controls.minDistance = 2;
        controls.maxDistance = 60;
        controls.target.set(15, 0, 0);
        controls.autoRotate = true;
        controls.autoRotate = 2.0;
        controls.update();

        let pmremGenerator = new THREE.PMREMGenerator(renderer);
        pmremGenerator.compileEquirectangularShader();

        window.addEventListener("resize", onWindowResize, false);
      }

      function createGUI() {
        let gui = new GUI({ name: "Damp setting" });
        gui.add(params, "showHome").name("Home View");
        gui.add(params, "showBoiler").name("Boiler");
        gui.add(params, "showFluid").name("Fluid Cooler");
        gui.add(params, "showPipes").name("Pipes");
        gui.add(params, "showWell").name("Geothermal Well");
        gui
          .add(params, "stormTroopers")
          .name("Storm Troopers")
          .onChange(function (val) {
            if (val === true) {
              scene.add(avatar);
              scene.add(st);
              scene.add(st2);
              scene.add(st3);
            } else {
              scene.remove(avatar);
              scene.remove(st);
              scene.remove(st2);
              scene.remove(st3);
            }
          });
        window.addEventListener("resize", onWindowResize, false);
      }

      function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
        render();
      }

      function animate() {
        requestAnimationFrame(animate);
        controls.update();
        render();
      }

      function render() {
        let delta = clock.getDelta();

        if (mixer !== undefined) {
          mixer.update(delta);
        }
        if (mixer2 !== undefined) {
          mixer2.update(delta);
        }
        if (mixer3 !== undefined) {
          mixer3.update(delta);
        }
        if (mixer4 !== undefined) {
          mixer4.update(delta);
        }

        renderer.render(scene, camera);
      }
    </script>
  </body>
</html>
